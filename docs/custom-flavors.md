# Custom Flavors

<!-- markdownlint-disable MD013 -->
<!-- @generated by .automation/build.py, please do not update manually -->
<!-- Instead, update descriptor files in megalinter/descriptors -->

## Overview

MegaLinter Custom Flavors allow you to create your own optimized Docker images with only the linters you actually use in your project. This can significantly reduce image size and improve performance.

Instead of using the full MegaLinter image (which includes all linters), you can create a custom flavor that contains only the specific linters your project needs.

## Benefits

- **Smaller Docker images**: Only includes the linters you actually use
- **Faster execution**: Reduced overhead from unused linters
- **Customizable**: Add your own dependencies and configuration
- **Maintained automatically**: Inherits security updates from the base MegaLinter image

## How it works

1. **Analysis**: Run MegaLinter on your project to identify which linters are used
2. **Configuration**: Create a `megalinter-custom-flavor.yml` file with your specific requirements
3. **Build**: Use the automated workflow to generate and publish your custom Docker image
4. **Use**: Reference your custom image in your CI/CD pipelines

## Quick Start

### Step 1: Set up custom flavor configuration

Use mega-linter-runner to initialize the custom flavor setup:

```bash
npx mega-linter-runner --custom-flavor-setup
```

This creates:
- `.github/workflows/megalinter-release-custom-flavor.yml` - Automated build workflow
- `megalinter-custom-flavor.yml` - Your flavor configuration file

### Step 2: Analyze your project

Run MegaLinter to see which linters are actually used:

Use MegaLinter workflow, or use command line (requires to have docker locally running)

```bash
npx mega-linter-runner
```

Check the generated `megalinter-reports/megalinter-custom-flavor.yml` file to see the recommended linters.

### Step 3: Customize your flavor

Edit `megalinter-custom-flavor.yml` with your specific requirements:

```yaml
flavor_name: "my-company-flavor"
flavor_description: "Custom MegaLinter flavor for our projects"

# Linters to include (from the analysis results)
linters:
  - "JAVASCRIPT_ES"
  - "TYPESCRIPT_ES"
  - "YAML_YAMLLINT"
  - "MARKDOWN_MARKDOWNLINT"
  - "DOCKERFILE_HADOLINT"

# Docker image configuration
docker_image: "ghcr.io/my-organization/my-custom-megalinter"
docker_tags:
  - "latest"
  - "v1.0.0"

# Registry configuration
registry:
  type: "ghcr"  # Options: "ghcr", "dockerhub", "custom"

# Optional: Additional dependencies
additional_dependencies:
  npm:
    - "@typescript-eslint/parser"
  pip:
    - "custom-python-tool"

# Optional: Environment variables
environment_variables:
  COMPANY_STANDARD: "strict"
```

### Step 4: Build and publish

Create a GitHub release in your repository to trigger the automated build:

1. Go to your repository's Releases page
2. Click "Create a new release"
3. Tag version: `v1.0.0`
4. Release title: `MegaLinter Custom Flavor v1.0.0`
5. Click "Publish release"

The workflow will automatically:
- Build your custom flavor Docker image
- Push it to your specified registry
- Make it available for use

### Step 5: Use your custom flavor

Update your CI/CD pipeline to use your custom image:

```yaml
# .github/workflows/mega-linter.yml
- name: MegaLinter
  uses: oxsecurity/megalinter/flavors/my-company@v8
  env:
    DEFAULT_BRANCH: main
    MEGALINTER_IMAGE: "ghcr.io/my-organization/my-custom-megalinter:latest"
```

Or with mega-linter-runner:

```bash
npx mega-linter-runner --image ghcr.io/my-organization/my-custom-megalinter:latest
```

## Configuration Reference

### Required Fields

| Field | Description | Example |
|-------|-------------|---------|
| `flavor_name` | Name of your custom flavor | `"my-company-flavor"` |
| `flavor_description` | Description of your flavor | `"Custom flavor for our projects"` |
| `linters` | List of linter IDs to include | `["JAVASCRIPT_ES", "YAML_YAMLLINT"]` |
| `docker_image` | Docker image name | `"ghcr.io/org/my-megalinter"` |

### Optional Fields

| Field | Description | Default |
|-------|-------------|---------|
| `docker_tags` | Tags to apply to the image | `["latest"]` |
| `base_image` | Base Docker image | `"alpine:3.18"` |
| `registry.type` | Registry type | `"ghcr"` |
| `additional_dependencies` | Extra packages to install | `{}` |
| `custom_dockerfile_commands` | Custom Dockerfile commands | `[]` |
| `environment_variables` | Default environment variables | `{}` |

### Registry Configuration

#### GitHub Container Registry (GHCR)

```yaml
registry:
  type: "ghcr"
```

Required secrets:
- `GITHUB_TOKEN` (automatically available)

#### Docker Hub

```yaml
registry:
  type: "dockerhub"
```

Required secrets:
- `DOCKERHUB_USERNAME`
- `DOCKERHUB_TOKEN`

#### Custom Registry

```yaml
registry:
  type: "custom"
  url: "https://my-registry.com"
  username: "my-username"
```

Required secrets:
- `REGISTRY_PASSWORD` or equivalent

### Additional Dependencies

You can add extra packages for any supported package manager:

```yaml
additional_dependencies:
  apk:
    - "curl"
    - "jq"
  npm:
    - "@custom/eslint-config"
    - "prettier-plugin-custom"
  pip:
    - "custom-python-linter"
    - "requests"
  gem:
    - "custom-ruby-gem"
  cargo:
    - "custom-rust-tool"
```

### Custom Dockerfile Commands

Add any custom Dockerfile commands:

```yaml
custom_dockerfile_commands:
  - "RUN echo 'Custom setup command'"
  - "COPY custom-config.json /opt/"
  - "ENV CUSTOM_VAR=value"
```

## Available Linters

To see all available linters and their IDs, run MegaLinter and check the logs, or refer to the [supported linters documentation](supported-linters.md).

Linter IDs follow the format: `{LANGUAGE}_{LINTER_NAME}`

Examples:
- `JAVASCRIPT_ES` - ESLint for JavaScript
- `PYTHON_FLAKE8` - Flake8 for Python
- `YAML_YAMLLINT` - yamllint for YAML files
- `DOCKERFILE_HADOLINT` - Hadolint for Dockerfiles

## Workflow Details

The generated workflow (`.github/workflows/megalinter-release-custom-flavor.yml`) performs these steps:

1. **Trigger**: Activates on GitHub releases
2. **Authentication**: Logs into your specified container registry
3. **Builder**: Pulls the appropriate MegaLinter flavor builder image
4. **Generation**: Creates a custom Dockerfile based on your configuration
5. **Build**: Builds your custom Docker image
6. **Push**: Publishes the image to your registry with specified tags

## Security Considerations

- **Base Image**: Uses the official MegaLinter base, inheriting security updates
- **Dependencies**: Additional dependencies are installed during build, not runtime
- **Secrets**: Uses GitHub secrets for registry authentication
- **Isolation**: Each custom flavor runs in its own container

## Troubleshooting

### Build Failures

**Error: "Linter not found"**
- Check that linter IDs in your configuration match available linters
- Run MegaLinter once to see available linter IDs in the logs

**Error: "Registry authentication failed"**
- Verify your registry credentials are correctly set as GitHub secrets
- For GHCR, ensure `GITHUB_TOKEN` has `packages: write` permission

**Error: "Dockerfile generation failed"**
- Check that your `megalinter-custom-flavor.yml` syntax is valid
- Ensure all required fields are present

### Image Size Issues

If your custom image is still large:
- Review the linters list and remove unused ones
- Check additional dependencies for unnecessary packages
- Consider using a smaller base image

### Performance Issues

If builds are slow:
- Reduce the number of linters to only essential ones
- Optimize additional dependencies installation
- Use multi-stage builds for complex custom commands

## Examples

### Minimal JavaScript Project

```yaml
flavor_name: "simple-js"
flavor_description: "Minimal flavor for JavaScript projects"
linters:
  - "JAVASCRIPT_ES"
  - "JSON_JSONLINT"
docker_image: "ghcr.io/myorg/simple-js-linter"
registry:
  type: "ghcr"
```

### Full-Stack Web Application

```yaml
flavor_name: "fullstack-web"
flavor_description: "Complete linting for full-stack web applications"
linters:
  - "JAVASCRIPT_ES"
  - "TYPESCRIPT_ES"
  - "CSS_STYLELINT"
  - "HTML_HTMLHINT"
  - "YAML_YAMLLINT"
  - "DOCKERFILE_HADOLINT"
  - "MARKDOWN_MARKDOWNLINT"
docker_image: "ghcr.io/myorg/fullstack-linter"
additional_dependencies:
  npm:
    - "@typescript-eslint/parser"
    - "eslint-config-prettier"
environment_variables:
  VALIDATE_ALL_CODEBASE: "true"
  TYPESCRIPT_ES_CONFIG_FILE: ".eslintrc.js"
registry:
  type: "ghcr"
```

### Enterprise Python Project

```yaml
flavor_name: "enterprise-python"
flavor_description: "Enterprise Python development flavor"
linters:
  - "PYTHON_FLAKE8"
  - "PYTHON_BLACK"
  - "PYTHON_MYPY"
  - "PYTHON_BANDIT"
  - "YAML_YAMLLINT"
  - "DOCKERFILE_HADOLINT"
docker_image: "docker.io/mycompany/python-linter"
additional_dependencies:
  pip:
    - "flake8-docstrings"
    - "flake8-import-order"
    - "mypy-extensions"
custom_dockerfile_commands:
  - "COPY .flake8 /opt/company-standards/"
environment_variables:
  PYTHON_FLAKE8_CONFIG_FILE: "/opt/company-standards/.flake8"
  PYTHON_BLACK_CONFIG_FILE: "pyproject.toml"
registry:
  type: "dockerhub"
```

## Best Practices

1. **Start Simple**: Begin with a minimal set of linters and add more as needed
2. **Regular Updates**: Update your custom flavor when you update MegaLinter
3. **Version Tagging**: Use semantic versioning for your custom flavor releases
4. **Documentation**: Document your custom flavor configuration for your team
5. **Testing**: Test your custom flavor in a development environment before production use

## Support

- [MegaLinter Documentation](https://megalinter.io)
- [GitHub Issues](https://github.com/oxsecurity/megalinter/issues)
- [Community Discussions](https://github.com/oxsecurity/megalinter/discussions)
